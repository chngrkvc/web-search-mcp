services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    ports:
      - "8191:8191"
    environment:
      - LOG_LEVEL=info
      - LOG_HTML=false
      - CAPTCHA_SOLVER=none
    restart: unless-stopped

  searxng:
    image: searxng/searxng:latest
    ports:
      - "8080:8080"
    volumes:
      - ./searxng-settings.yml:/etc/searxng/settings.yml:ro
    environment:
      - SEARXNG_SECRET_KEY=dev-secret-key
      - SEARXNG_REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis
      - flaresolverr
    restart: unless-stopped

  crawl4ai:
    image: unclecode/crawl4ai:latest
    ports:
      - "11235:11235"
    environment:
      - CRAWL4AI_API_TOKEN=${CRAWL4AI_API_TOKEN:-}

  web_search:
    build: .
    ports:
      - "3000:3000"
    environment:
      - SEARXNG_URL=http://searxng:8080
      - CRAWL4AI_URL=http://crawl4ai:11235
      - PORT=3000
    env_file:
      - .env.local
    depends_on:
      - searxng
      - crawl4ai
